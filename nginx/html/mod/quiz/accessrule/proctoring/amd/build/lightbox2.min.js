define ("quizaccess_proctoring/lightbox2",["jquery"],function(a){function b(b){this.album=[];this.currentImageIndex=void 0;this.init();this.options=a.extend({},this.constructor.defaults);this.option(b)}b.defaults={albumLabel:"Image %1 of %2",alwaysShowNavOnTouchDevices:!1,fadeDuration:300,fitImagesInViewport:!0,imageFadeDuration:300,positionFromTop:100,resizeDuration:700,showImageNumberLabel:!0,wrapAround:!1,disableScrolling:!1,sanitizeTitle:!1};b.prototype.option=function(b){a.extend(this.options,b)};b.prototype.imageCountLabel=function(a,b){return this.options.albumLabel.replace(/%1/g,a).replace(/%2/g,b)};b.prototype.init=function(){var b=this;a(document).ready(function(){b.enable();b.build()})};b.prototype.enable=function(){var b=this;a("body").on("click","a[rel^=lightbox], area[rel^=lightbox], a[data-lightbox], area[data-lightbox]",function(c){b.start(a(c.currentTarget));return!1})};b.prototype.build=function(){if(0<a("#lightbox").length){return}var b=this;a("<div id=\"lightboxOverlay\" tabindex=\"-1\" class=\"lightboxOverlay\"></div><div id=\"lightbox\" tabindex=\"-1\" class=\"lightbox\"><div class=\"lb-outerContainer\"><div class=\"lb-container\"><img class=\"lb-image\" src=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==\" alt=\"\"/><div class=\"lb-nav\"><a class=\"lb-prev\" aria-label=\"Previous image\" href=\"\" ></a><a class=\"lb-next\" aria-label=\"Next image\" href=\"\" ></a></div><div class=\"lb-loader\"><a class=\"lb-cancel\"></a></div></div></div><div class=\"lb-dataContainer\"><div class=\"lb-data\"><div class=\"lb-details\"><span class=\"lb-caption\"></span><span class=\"lb-number\"></span></div><div class=\"lb-closeContainer\"><a class=\"lb-close\"></a></div></div></div></div>").appendTo(a("body"));this.$lightbox=a("#lightbox");this.$overlay=a("#lightboxOverlay");this.$outerContainer=this.$lightbox.find(".lb-outerContainer");this.$container=this.$lightbox.find(".lb-container");this.$image=this.$lightbox.find(".lb-image");this.$nav=this.$lightbox.find(".lb-nav");this.containerPadding={top:parseInt(this.$container.css("padding-top"),10),right:parseInt(this.$container.css("padding-right"),10),bottom:parseInt(this.$container.css("padding-bottom"),10),left:parseInt(this.$container.css("padding-left"),10)};this.imageBorderWidth={top:parseInt(this.$image.css("border-top-width"),10),right:parseInt(this.$image.css("border-right-width"),10),bottom:parseInt(this.$image.css("border-bottom-width"),10),left:parseInt(this.$image.css("border-left-width"),10)};this.$overlay.hide().on("click",function(){b.end();return!1});this.$lightbox.hide().on("click",function(c){if("lightbox"===a(c.target).attr("id")){b.end()}});this.$outerContainer.on("click",function(c){if("lightbox"===a(c.target).attr("id")){b.end()}return!1});this.$lightbox.find(".lb-prev").on("click",function(){if(0===b.currentImageIndex){b.changeImage(b.album.length-1)}else{b.changeImage(b.currentImageIndex-1)}return!1});this.$lightbox.find(".lb-next").on("click",function(){if(b.currentImageIndex===b.album.length-1){b.changeImage(0)}else{b.changeImage(b.currentImageIndex+1)}return!1});this.$nav.on("mousedown",function(a){if(3===a.which){b.$nav.css("pointer-events","none");b.$lightbox.one("contextmenu",function(){setTimeout(function(){this.$nav.css("pointer-events","auto")}.bind(b),0)})}});this.$lightbox.find(".lb-loader, .lb-close").on("click",function(){b.end();return!1});this.$lightbox.append("<button id='analyze_image_btn' class='btn btn-primary'> Analyze</button>");this.$lightbox.find("#analyze_image_btn").on("click",function(){var c=b.$lightbox.find(".lb-image");if(0<c.length){var d=c[0],e=d.src,f=e.split("/");if(0<f.length){for(var g=f[f.length-1],h=a("img[src$='"+g+"']"),j=0,k;j<h.length;j++){k=h[j].id;if(k.includes("reportid-")){var l=k.split("-"),m=l[1],n=window.location.href,o=new URL(n),p=o.searchParams.get("courseid"),q=o.searchParams.get("quizid"),r=o.searchParams.get("cmid"),s=o.searchParams.get("studentid"),t=o.searchParams.get("reportid"),u=n.split("report.php"),v=u[0]+"analyzesingleimage.php?courseid="+p+"&quizid="+q+"&cmid="+r+"&studentid="+s+"&reportid="+t+"&imgid="+m;window.location.href=v}}}}})};b.prototype.start=function(b){var d=this,e=a(window);e.on("resize",a.proxy(this.sizeOverlay,this));this.sizeOverlay();this.album=[];var f=0;function c(a){d.album.push({alt:a.attr("data-alt"),link:a.attr("href"),title:a.attr("data-title")||a.attr("title")})}var g=b.attr("data-lightbox"),h;if(g){h=a(b.prop("tagName")+"[data-lightbox=\""+g+"\"]");for(var k=0;k<h.length;k=++k){c(a(h[k]));if(h[k]===b[0]){f=k}}}else{if("lightbox"===b.attr("rel")){c(b)}else{h=a(b.prop("tagName")+"[rel=\""+b.attr("rel")+"\"]");for(var l=0;l<h.length;l=++l){c(a(h[l]));if(h[l]===b[0]){f=l}}}}var m=e.scrollTop()+this.options.positionFromTop,n=e.scrollLeft();this.$lightbox.css({top:m+"px",left:n+"px"}).fadeIn(this.options.fadeDuration);if(this.options.disableScrolling){a("body").addClass("lb-disable-scrolling")}this.changeImage(f)};b.prototype.changeImage=function(b){var c=this,d=this.album[b].link,e=d.split(".").slice(-1)[0],f=this.$lightbox.find(".lb-image");this.disableKeyboardNav();this.$overlay.fadeIn(this.options.fadeDuration);a(".lb-loader").fadeIn("slow");this.$lightbox.find(".lb-image, .lb-nav, .lb-prev, .lb-next, .lb-dataContainer, .lb-numbers, .lb-caption").hide();this.$outerContainer.addClass("animating");var g=new Image;g.onload=function(){var h,i,j,k,l,m;f.attr({alt:c.album[b].alt,src:d});a(g);f.width(g.width);f.height(g.height);m=a(window).width();l=a(window).height();k=m-c.containerPadding.left-c.containerPadding.right-c.imageBorderWidth.left-c.imageBorderWidth.right-20;j=l-c.containerPadding.top-c.containerPadding.bottom-c.imageBorderWidth.top-c.imageBorderWidth.bottom-c.options.positionFromTop-70;if("svg"===e){f.width(k);f.height(j)}if(c.options.fitImagesInViewport){if(c.options.maxWidth&&c.options.maxWidth<k){k=c.options.maxWidth}if(c.options.maxHeight&&c.options.maxHeight<j){j=c.options.maxHeight}}else{k=c.options.maxWidth||g.width||k;j=c.options.maxHeight||g.height||j}if(g.width>k||g.height>j){if(g.width/k>g.height/j){i=k;h=parseInt(g.height/(g.width/i),10);f.width(i);f.height(h)}else{h=j;i=parseInt(g.width/(g.height/h),10);f.width(i);f.height(h)}}c.sizeContainer(f.width(),f.height())};g.src=this.album[b].link;this.currentImageIndex=b};b.prototype.sizeOverlay=function(){var b=this;setTimeout(function(){b.$overlay.width(a(document).width()).height(a(document).height())},0)};b.prototype.sizeContainer=function(a,b){var d=this,e=this.$outerContainer.outerWidth(),f=this.$outerContainer.outerHeight(),g=a+this.containerPadding.left+this.containerPadding.right+this.imageBorderWidth.left+this.imageBorderWidth.right,h=b+this.containerPadding.top+this.containerPadding.bottom+this.imageBorderWidth.top+this.imageBorderWidth.bottom;function c(){d.$lightbox.find(".lb-dataContainer").width(g);d.$lightbox.find(".lb-prevLink").height(h);d.$lightbox.find(".lb-nextLink").height(h);d.$overlay.focus();d.showImage()}if(e!==g||f!==h){this.$outerContainer.animate({width:g,height:h},this.options.resizeDuration,"swing",function(){c()})}else{c()}};b.prototype.showImage=function(){this.$lightbox.find(".lb-loader").stop(!0).hide();this.$lightbox.find(".lb-image").fadeIn(this.options.imageFadeDuration);this.updateNav();this.updateDetails();this.preloadNeighboringImages();this.enableKeyboardNav()};b.prototype.updateNav=function(){var a=!1;try{document.createEvent("TouchEvent");a=this.options.alwaysShowNavOnTouchDevices?!0:!1}catch(a){}this.$lightbox.find(".lb-nav").show();if(1<this.album.length){if(this.options.wrapAround){if(a){this.$lightbox.find(".lb-prev, .lb-next").css("opacity","1")}this.$lightbox.find(".lb-prev, .lb-next").show()}else{if(0<this.currentImageIndex){this.$lightbox.find(".lb-prev").show();if(a){this.$lightbox.find(".lb-prev").css("opacity","1")}}if(this.currentImageIndex<this.album.length-1){this.$lightbox.find(".lb-next").show();if(a){this.$lightbox.find(".lb-next").css("opacity","1")}}}}};b.prototype.updateDetails=function(){var a=this;if("undefined"!=typeof this.album[this.currentImageIndex].title&&""!==this.album[this.currentImageIndex].title){var b=this.$lightbox.find(".lb-caption");if(this.options.sanitizeTitle){b.text(this.album[this.currentImageIndex].title)}else{b.html(this.album[this.currentImageIndex].title)}b.fadeIn("fast")}if(1<this.album.length&&this.options.showImageNumberLabel){var c=this.imageCountLabel(this.currentImageIndex+1,this.album.length);this.$lightbox.find(".lb-number").text(c).fadeIn("fast")}else{this.$lightbox.find(".lb-number").hide()}this.$outerContainer.removeClass("animating");this.$lightbox.find(".lb-dataContainer").fadeIn(this.options.resizeDuration,function(){return a.sizeOverlay()})};b.prototype.preloadNeighboringImages=function(){if(this.album.length>this.currentImageIndex+1){var a=new Image;a.src=this.album[this.currentImageIndex+1].link}if(0<this.currentImageIndex){var b=new Image;b.src=this.album[this.currentImageIndex-1].link}};b.prototype.enableKeyboardNav=function(){this.$lightbox.on("keyup.keyboard",a.proxy(this.keyboardAction,this));this.$overlay.on("keyup.keyboard",a.proxy(this.keyboardAction,this))};b.prototype.disableKeyboardNav=function(){this.$lightbox.off(".keyboard");this.$overlay.off(".keyboard")};b.prototype.keyboardAction=function(a){var b=a.keyCode;if(b===27){a.stopPropagation();this.end()}else if(b===37){if(0!==this.currentImageIndex){this.changeImage(this.currentImageIndex-1)}else if(this.options.wrapAround&&1<this.album.length){this.changeImage(this.album.length-1)}}else if(b===39){if(this.currentImageIndex!==this.album.length-1){this.changeImage(this.currentImageIndex+1)}else if(this.options.wrapAround&&1<this.album.length){this.changeImage(0)}}};b.prototype.end=function(){this.disableKeyboardNav();a(window).off("resize",this.sizeOverlay);this.$lightbox.fadeOut(this.options.fadeDuration);this.$overlay.fadeOut(this.options.fadeDuration);if(this.options.disableScrolling){a("body").removeClass("lb-disable-scrolling")}};return new b});
//# sourceMappingURL=lightbox2.min.js.map

function asyncGeneratorStep(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){c(a);return}if(h.done){b(i)}else{Promise.resolve(i).then(d,e)}}function _asyncToGenerator(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){var h=a.apply(b,c);function f(a){asyncGeneratorStep(h,d,e,f,g,"next",a)}function g(a){asyncGeneratorStep(h,d,e,f,g,"throw",a)}f(void 0)})}}define ("quizaccess_proctoring/startAttempt",["jquery","core/ajax","core/notification"],function(a,b,c){return{setup:function setup(d){console.log(d.examurl);document.getElementById("id_submitbutton");a("#id_submitbutton").css("display","none");var e,f=a("<button disabled class=\"btn btn-primary\" id=\"id_start_quiz\">Start Quiz</button>").click(function(){var a=document.getElementsByName("sesskey")[0].value,b=d.examurl+"?cmid="+d.cmid+"&sesskey="+a;console.log("url",b);event.preventDefault();e=window.open(b,"_blank")});a("#id_submitbutton").after(f);var g=d.enablescreenshare;if(1==g){var h=function(){var a=_asyncToGenerator(regeneratorRuntime.mark(function a(){var b;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:k.innerHTML="";a.prev=1;a.next=4;return navigator.mediaDevices.getDisplayMedia(l);case 4:j.srcObject=a.sent;i();m();a.next=15;break;case 9:a.prev=9;a.t0=a["catch"](1);b=a.t0.toString();if(!("NotAllowedError: Permission denied"==b)){a.next=15;break}alert("Please share entire screen.");return a.abrupt("return",!1);case 15:case"end":return a.stop();}}},a,null,[[1,9]])}));return function(){return a.apply(this,arguments)}}(),i=function(){};window.share_state=document.getElementById("share_state");window.window_surface=document.getElementById("window_surface");window.screenoff=document.getElementById("screen_off_flag");var j=document.getElementById("video-screen"),k=document.getElementById("log-screen"),l={video:{cursor:"always"},audio:!1};a("#share_screen_btn").click(function(){event.preventDefault();h();a("#form_activate").css("visibility","visible")});a(window).on("beforeunload",function(){e.close()});window.addEventListener("locationchange",function(){console.log("location changed!");e.close()});var m=function(){if(null!==j.srcObject){var a=j.srcObject.getVideoTracks()[0],b=j.srcObject,c=b.active,d=a.getSettings(),f=d.displaySurface;document.getElementById("window_surface").value=f;document.getElementById("display_surface").innerHTML=f;document.getElementById("share_screen_status").innerHTML=c;document.getElementById("share_state").value=c;document.getElementById("screen_off_flag").value;console.log(document.getElementById("window_surface"));if("monitor"!==f){e.close();console.log("quiz window closed")}if(!c){e.close()}}},n=function(){var a=document.getElementById("screen_off_flag").value;if(null!==j.srcObject){var f=j.srcObject.getVideoTracks()[0],g=j.srcObject,h=g.active,i=f.getSettings(),k=i.displaySurface;if("0"==a){if(!h){alert("Sorry !! You need to restart the attempt as you have stopped the screenshare.");document.getElementById("display_surface").innerHTML=k;document.getElementById("share_screen_status").innerHTML="Disabled";clearInterval(o);e.close();return!1}console.log(k);if("monitor"!==k){alert("Sorry !! You need to share entire screen.");document.getElementById("display_surface").innerHTML=k;document.getElementById("share_screen_status").innerHTML="Disabled";clearInterval(o);e.close();return!1}}var l=document.getElementById("video-screen"),m=document.getElementById("canvas-screen"),n=m.getContext("2d");m.width=screen.width;m.height=screen.height;n.drawImage(l,0,0,screen.width,screen.height);var p=m.toDataURL("image/png"),q={courseid:d.courseid,screenshotid:d.id,quizid:d.cmid,webcampicture:p,imagetype:2};if("0"==a){b.call([{methodname:"quizaccess_proctoring_send_camshot",args:q}])[0].done(function(a){if(!(1>a.warnings.length)){if(l){c.addNotification({message:"Something went wrong during taking the image.",type:"error"});clearInterval(o)}}}).fail(c.exception)}}},o=setInterval(n,d.screenshotinterval),p=setInterval(m,1e3)}a("#fcvalidate").click(function(){event.preventDefault();var d=document.getElementById("photo"),e=document.getElementById("canvas"),f=document.getElementById("video"),h=e.getContext("2d");h.drawImage(f,0,0,e.width,e.height);var i=e.toDataURL("image/png");d.setAttribute("src",i);var j=document.getElementById("courseidval").value,k=document.getElementById("cmidval").value,l=document.getElementById("profileimage").value;document.getElementById("loading_spinner").style.display="block";b.call([{methodname:"quizaccess_proctoring_validate_face",args:{courseid:j,cmid:k,profileimage:l,webcampicture:i}}])[0].done(function(b){if(1>b.warnings.length){document.getElementById("loading_spinner").style.display="none";var d=b.status;if("success"==d){a("#video").css("border","10px solid green");a("#face_validation_result").html("<span style=\"color: green\">True</span>");document.getElementById("fcvalidate").style.display="none";if(1==g){document.getElementById("share_screen_btn").style.display="block"}else{a("#form_activate").css("visibility","visible")}}else{a("#video").css("border","10px solid red");a("#face_validation_result").html("<span style=\"color: red\">False</span>")}}else{document.getElementById("loading_spinner").style.display="none";if(f){c.addNotification({message:"Something went wrong during taking the image.",type:"error"})}}}).fail(c.exception)});return!0}}});
//# sourceMappingURL=startAttempt.min.js.map

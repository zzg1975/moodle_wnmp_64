{"version":3,"sources":["../src/startAttempt.js"],"names":["define","$","Ajax","Notification","setup","props","console","log","examurl","document","getElementById","css","quizwindow","startbtn","click","sesskey","getElementsByName","value","url","cmid","event","preventDefault","window","open","after","enablesharescreen","enablescreenshare","startCapture","logElem","innerHTML","navigator","mediaDevices","getDisplayMedia","displayMediaOptions","videoElem","srcObject","dumpOptionsInfo","updateWindowStatus","errString","toString","alert","share_state","window_surface","screenoff","video","cursor","audio","on","close","addEventListener","videoTrack","getVideoTracks","currentStream","active","settings","getSettings","displaySurface","takeScreenshot","clearInterval","screenShotInterval","video_screen","canvas_screen","screen_context","getContext","width","screen","height","drawImage","screen_data","toDataURL","params","courseid","id","call","methodname","args","done","data","warnings","length","addNotification","message","type","fail","exception","setInterval","screenshotinterval","windowState","photo","canvas","context","setAttribute","profileimage","style","display","status","html"],"mappings":"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","sourcesContent":["define(['jquery', 'core/ajax', 'core/notification'],\r\n    function($, Ajax, Notification) {\r\n        return {\r\n            setup: function(props) {\r\n                // $(\"body\").attr(\"oncopy\",\"return false;\");\r\n                // $(\"body\").attr(\"oncut\",\"return false;\");\r\n                // $(\"body\").attr(\"onpaste\",\"return false;\");\r\n                // $(\"body\").attr(\"oncontextmenu\",\"return false;\");\r\n                // console.log(props);\r\n                console.log(props.examurl);\r\n                var submitbtn = document.getElementById('id_submitbutton');\r\n                \r\n                $(\"#id_submitbutton\").css(\"display\", \"none\");\r\n                var quizwindow;\r\n                var startbtn = $('<button disabled class=\"btn btn-primary\" id=\"id_start_quiz\">Start Quiz</button>').click(function () {\r\n                    // var url = props.examurl+'?attempt='+props.attemptid+'&cmid='+props.cmid;\r\n                    \r\n                    var sesskey = document.getElementsByName(\"sesskey\")[0].value;\r\n                    var url = props.examurl+'?cmid='+props.cmid+'&sesskey='+sesskey;\r\n                    console.log('url',url);\r\n                    event.preventDefault();\r\n                    // alert('hi');\r\n                    quizwindow = window.open(url, '_blank');\r\n                });\r\n\r\n                // var quizlink = \"<a href='http://www.google.com' target='_blank' class='btn btn-primary'>Start Quiz</a>\";\r\n                $( \"#id_submitbutton\" ).after(startbtn);\r\n                \r\n                var enablesharescreen = props.enablescreenshare;\r\n                if(enablesharescreen == 1){\r\n                    window.share_state = document.getElementById('share_state');\r\n                    window.window_surface = document.getElementById('window_surface');\r\n                    window.screenoff = document.getElementById('screen_off_flag');\r\n\r\n                    const videoElem = document.getElementById(\"video-screen\");\r\n                    const logElem = document.getElementById(\"log-screen\");\r\n                    var displayMediaOptions = {\r\n                        video: {\r\n                            cursor: \"always\"\r\n                        },\r\n                        audio: false\r\n                    };\r\n\r\n                    $(\"#share_screen_btn\").click(function() {\r\n                        event.preventDefault();\r\n                        // Console.log('screen sharing clicked');\r\n                        startCapture();\r\n                        $(\"#form_activate\").css(\"visibility\", \"visible\");\r\n                        // Options for getDisplayMedia()\r\n\r\n                    });\r\n\r\n                    async function startCapture() {\r\n                        logElem.innerHTML = \"\";\r\n                        try {\r\n                            // Console.log(\"vid found success\");\r\n                            videoElem.srcObject = await navigator.mediaDevices.getDisplayMedia(displayMediaOptions);\r\n                            dumpOptionsInfo();\r\n                            updateWindowStatus();\r\n                        } catch (err) {\r\n                            // Console.log(\"Error: \" + err.toString());\r\n                            let errString = err.toString();\r\n                            if (errString == \"NotAllowedError: Permission denied\") {\r\n                                alert(\"Please share entire screen.\");\r\n                                return false;\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    function dumpOptionsInfo() {\r\n                        // Const videoTrack = videoElem.srcObject.getVideoTracks()[0];\r\n\r\n                        // Console.info(\"Track settings:\");\r\n                        // console.info(JSON.stringify(videoTrack.getSettings(), null, 2));\r\n                        // console.info(\"Track constraints:\");\r\n                        // console.info(JSON.stringify(videoTrack.getConstraints(), null, 2));\r\n                    }\r\n\r\n                    $(window).on(\"beforeunload\", function() {\r\n                        quizwindow.close();\r\n                    })\r\n                    \r\n                    window.addEventListener('locationchange', function(){\r\n                        console.log('location changed!');\r\n                        quizwindow.close();\r\n                    })\r\n\r\n                    var updateWindowStatus = function() {\r\n                        if (videoElem.srcObject !== null) {\r\n                            // Console.log(videoElem);\r\n                            const videoTrack = videoElem.srcObject.getVideoTracks()[0];\r\n                            var currentStream = videoElem.srcObject;\r\n                            var active = currentStream.active;\r\n                            var settings = videoTrack.getSettings();\r\n                            var displaySurface = settings.displaySurface;\r\n                            document.getElementById('window_surface').value = displaySurface;\r\n                            document.getElementById('display_surface').innerHTML = displaySurface;\r\n                            document.getElementById('share_screen_status').innerHTML = active;\r\n                            document.getElementById('share_state').value = active;\r\n                            var screenoff = document.getElementById('screen_off_flag').value;\r\n                            \r\n                            console.log(document.getElementById('window_surface'));\r\n                            if(displaySurface !== 'monitor'){\r\n                                // window close \r\n                                quizwindow.close();\r\n                                console.log('quiz window closed');\r\n                            }\r\n                            \r\n                            if(!active){\r\n                                quizwindow.close();\r\n                            }\r\n                            \r\n                            // if (screenoff == \"1\") {\r\n                            //     videoTrack.stop();\r\n                            //     quizwindow.close();\r\n                            //     console.log('quiz window closed');\r\n                            //     clearInterval(windowState);\r\n                            //     // location.reload();\r\n                            // }\r\n                        }\r\n                    };\r\n\r\n                    var takeScreenshot = function() {\r\n                        var screenoff = document.getElementById('screen_off_flag').value;\r\n                        if (videoElem.srcObject !== null) {\r\n                            // Console.log(videoElem);\r\n                            const videoTrack = videoElem.srcObject.getVideoTracks()[0];\r\n                            var currentStream = videoElem.srcObject;\r\n                            var active = currentStream.active;\r\n                            // Console.log(active);\r\n\r\n                            var settings = videoTrack.getSettings();\r\n                            var displaySurface = settings.displaySurface;\r\n\r\n                            if (screenoff == \"0\") {\r\n                                if (!active) {\r\n                                    alert(\"Sorry !! You need to restart the attempt as you have stopped the screenshare.\");\r\n                                    document.getElementById('display_surface').innerHTML = displaySurface;\r\n                                    document.getElementById('share_screen_status').innerHTML = 'Disabled';\r\n                                    clearInterval(screenShotInterval);\r\n                                    // window.close();\r\n                                    quizwindow.close();\r\n                                    return false;\r\n                                }\r\n                                console.log(displaySurface);\r\n\r\n                                if (displaySurface !== \"monitor\") {\r\n                                    // console.log(displaySurface);\r\n                                    alert(\"Sorry !! You need to share entire screen.\");\r\n                                    document.getElementById('display_surface').innerHTML = displaySurface;\r\n                                    document.getElementById('share_screen_status').innerHTML = 'Disabled';\r\n                                    clearInterval(screenShotInterval);\r\n                                    // window.close();\r\n                                    quizwindow.close();\r\n                                    return false;\r\n                                }\r\n\r\n                            }\r\n                            // Console.log(displaySurface);\r\n                            // console.log(quizurl);\r\n\r\n                            // Capture Screen\r\n                            var video_screen = document.getElementById('video-screen');\r\n                            var canvas_screen = document.getElementById('canvas-screen');\r\n                            var screen_context = canvas_screen.getContext('2d');\r\n                            // Var photo_screen = document.getElementById('photo_screen');\r\n                            canvas_screen.width = screen.width;\r\n                            canvas_screen.height = screen.height;\r\n                            screen_context.drawImage(video_screen, 0, 0, screen.width, screen.height);\r\n                            var screen_data = canvas_screen.toDataURL('image/png');\r\n                            // Photo_screen.setAttribute('src', screen_data);\r\n                            // console.log(screen_data);\r\n\r\n                            // API Call\r\n                            var wsfunction = 'quizaccess_proctoring_send_camshot';\r\n                            var params = {\r\n                                'courseid': props.courseid,\r\n                                'screenshotid': props.id,\r\n                                'quizid': props.cmid,\r\n                                'webcampicture': screen_data,\r\n                                'imagetype': 2\r\n                            };\r\n\r\n                            var request = {\r\n                                methodname: wsfunction,\r\n                                args: params\r\n                            };\r\n\r\n                            // Console.log('params', params);\r\n                            if (screenoff == \"0\") {\r\n                                Ajax.call([request])[0].done(function(data) {\r\n                                    if (data.warnings.length < 1) {\r\n                                        // NO; pictureCounter++;\r\n                                    } else {\r\n                                        if (video_screen) {\r\n                                            Notification.addNotification({\r\n                                                message: 'Something went wrong during taking the image.',\r\n                                                type: 'error'\r\n                                            });\r\n                                            clearInterval(screenShotInterval);\r\n                                        }\r\n                                    }\r\n                                }).fail(Notification.exception);\r\n                            }\r\n                        }\r\n                    };\r\n\r\n                    var screenShotInterval = setInterval(takeScreenshot, props.screenshotinterval);\r\n                    var windowState = setInterval(updateWindowStatus, 1000);\r\n                }\r\n\r\n                $(\"#fcvalidate\").click(function() {\r\n                    event.preventDefault();\r\n                    // Console.log('validate face clicked');\r\n                    var photo = document.getElementById('photo');\r\n                    var canvas = document.getElementById('canvas');\r\n                    var video = document.getElementById('video');\r\n                    var context = canvas.getContext('2d');\r\n                    context.drawImage(video, 0, 0, canvas.width, canvas.height);\r\n                    var data = canvas.toDataURL('image/png');\r\n                    photo.setAttribute('src', data);\r\n\r\n                    var courseid = document.getElementById('courseidval').value;\r\n                    var cmid = document.getElementById('cmidval').value;\r\n                    var profileimage = document.getElementById('profileimage').value;\r\n\r\n                    var wsfunction = 'quizaccess_proctoring_validate_face';\r\n                    var params = {\r\n                        'courseid': courseid,\r\n                        'cmid': cmid,\r\n                        'profileimage': profileimage,\r\n                        'webcampicture': data,\r\n                    };\r\n\r\n                    var request = {\r\n                        methodname: wsfunction,\r\n                        args: params\r\n                    };\r\n                    document.getElementById('loading_spinner').style.display = 'block';\r\n                    Ajax.call([request])[0].done(function(data) {\r\n                        if (data.warnings.length < 1) {\r\n                            document.getElementById('loading_spinner').style.display = 'none';\r\n                            // NO; pictureCounter++;\r\n                            // console.log('api response', data);\r\n                            var status = data.status;\r\n                            if (status == 'success') {\r\n                                $(\"#video\").css(\"border\", \"10px solid green\");\r\n                                $(\"#face_validation_result\").html('<span style=\"color: green\">True</span>');\r\n                                // Document.getElementById(\"validate_form\").style.display = \"none\";\r\n                                document.getElementById(\"fcvalidate\").style.display = \"none\";\r\n                                // console.log(enablesharescreen);\r\n                                if(enablesharescreen == 1){\r\n                                    document.getElementById(\"share_screen_btn\").style.display = \"block\";\r\n                                }\r\n                                else{\r\n                                    $(\"#form_activate\").css(\"visibility\", \"visible\");\r\n                                }\r\n                            } else {\r\n                                $(\"#video\").css(\"border\", \"10px solid red\");\r\n                                $(\"#face_validation_result\").html('<span style=\"color: red\">False</span>');\r\n                            }\r\n                        } else {\r\n                            document.getElementById('loading_spinner').style.display = 'none';\r\n                            if (video) {\r\n                                Notification.addNotification({\r\n                                    message: 'Something went wrong during taking the image.',\r\n                                    type: 'error'\r\n                                });\r\n                            }\r\n                        }\r\n                    }).fail(Notification.exception);\r\n\r\n                });\r\n\r\n                return true;\r\n            }\r\n        };\r\n    });\r\n"],"file":"startAttempt.min.js"}